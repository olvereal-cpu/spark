<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spark Dating</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #000; color: white; margin: 0; padding: 0; height: 100vh; width: 100vw; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        .card-container { position: relative; width: 95vw; height: 90vh; display: flex; justify-content: center; align-items: center; }
        .card { position: absolute; width: 100%; height: 100%; border-radius: 20px; overflow: hidden; display: none; background: #1a1a1a; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #333; }
        .card.active { display: block; }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .vip-badge { position: absolute; top: 15px; right: 15px; background: linear-gradient(45deg, #ffbd00, #ff9500); color: black; padding: 5px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; z-index: 10; }
        .info { position: absolute; bottom: 120px; width: 100%; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.9) 60%, transparent); box-sizing: border-box; z-index: 5; }
        .name { font-size: 26px; font-weight: bold; margin-bottom: 5px; }
        .desc { font-size: 14px; color: #ccc; line-height: 1.3; }
        .controls { position: absolute; bottom: 30px; display: flex; gap: 40px; justify-content: center; width: 100%; z-index: 100; }
        .btn { width: 75px; height: 75px; border-radius: 50%; border: none; display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 32px; transition: 0.2s; box-shadow: 0 4px 20px rgba(0,0,0,0.8); }
        .btn-no { background: rgba(38, 38, 38, 0.9); color: #ff4444; border: 1px solid #444; }
        .btn-yes { background: linear-gradient(45deg, #ff3366, #ff6633); color: white; }
        .btn:active { transform: scale(0.8); }
        .blur { filter: blur(25px); transform: scale(1.1); }
        .pay-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 200; text-align: center; padding: 25px; box-sizing: border-box; }
        .feature-item { font-size: 15px; margin-bottom: 12px; display: flex; align-items: center; gap: 10px; width: 100%; max-width: 240px; text-align: left; }
        .pay-btn { background: #fff; color: #000; border: none; padding: 18px 45px; border-radius: 35px; font-weight: bold; font-size: 17px; margin-top: 25px; }
    </style>
</head>
<body>

    <div class="card-container">
        <div id="container" style="width: 100%; height: 100%;"></div>
        <div class="controls" id="controls">
            <button class="btn btn-no" onclick="nextCard()">‚úñ</button>
            <button class="btn btn-yes" onclick="nextCard()">‚ù§Ô∏è</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const urlParams = new URLSearchParams(window.location.search);
        const isVip = urlParams.get('is_vip') === '1';
        const API_URL = "https://son-unbridled-randell.ngrok-free.dev/api/profiles";

        let users = [
            { id: 999, name: "–ê–ª—ë–Ω–∞", age: 21, city: "–ú–æ—Å–∫–≤–∞", photo: "https://via.placeholder.com/400x600?text=Alena", desc: "–õ—é–±–ª—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è" },
            { id: 998, name: "–ö–∞—Ç—è", age: 19, city: "–ü–∏—Ç–µ—Ä", photo: "https://via.placeholder.com/400x600?text=Katya", desc: "–†–∏—Å—É—é –∫–∞—Ä—Ç–∏–Ω—ã" }
        ];

        let current = 0;

        async function loadProfiles() {
            try {
                console.log("–ó–∞–≥—Ä—É–∑–∫–∞ —Å:", API_URL);
                const response = await fetch(API_URL, {
                    headers: { "ngrok-skip-browser-warning": "true" }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.length > 0) {
                        // –ú–∞–ø–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –ø–æ–¥ —Ñ–æ—Ä–º–∞—Ç –∫–∞—Ä—Ç–æ—á–µ–∫
                        const dbUsers = data.map(u => ({
                            id: u.id,
                            name: u.name,
                            age: u.age || "",
                            city: u.city || "",
                            photo: u.photo, // –¢—É—Ç —É–∂–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Å—ã–ª–∫–∞ ngrok –∏–∑ Python
                            desc: u.description || "–ü—Ä–∏–≤–µ—Ç! –î–∞–≤–∞–π –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è."
                        }));
                        users = [...dbUsers, ...users];
                        console.log("–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ");
                    }
                }
            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π:", err);
            }
            render();
        }

        function render() {
    const container = document.getElementById('container');
    const controls = document.getElementById('controls');
    if (!container) return;
    container.innerHTML = '';

    if (users.length === 0) {
        container.innerHTML = "<h2 style='text-align:center; margin-top:50px;'>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∫–µ—Ç...</h2>";
        return;
    }

    const u = users[current];
    const card = document.createElement('div');
    card.className = "card active";

    // –ü–†–û–í–ï–†–ö–ê –î–ê–ù–ù–´–•: –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º—Å—è –ø–æ–¥ –ø–æ–ª—è –∏–∑ Python
    // –ï—Å–ª–∏ –≤ Python –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è 'photo', 'img' –∏–ª–∏ 'file_id'
    const userPhoto = u.photo || u.img || u.file_id || 'https://via.placeholder.com/400x600?text=No+Photo';
    const userName = u.name || "–ë–µ–∑ –∏–º–µ–Ω–∏";
    const userAge = u.age || "";
    const userCity = u.city || "";
    const userDesc = u.description || u.desc || "–ü—Ä–∏–≤–µ—Ç! –î–∞–≤–∞–π –∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è.";

    if (!isVip && current >= 3) {
        // –õ–æ–≥–∏–∫–∞ VIP-–∑–∞–º–∫–∞
        card.innerHTML = `
            <img src="${userPhoto}" class="blur">
            <div class="pay-overlay">
                <h2 style="color: #ffbd00;">üëë GOLD VIP</h2>
                <p>–ê–Ω–∫–µ—Ç—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å</p>
                <button class="pay-btn" onclick="goToPay()">–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ 50 ‚≠êÔ∏è</button>
            </div>
        `;
        if (controls) controls.style.display = 'none';
    } else {
        // –û–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
        if (controls) controls.style.display = 'flex';
        card.innerHTML = `
            <img src="${userPhoto}" onerror="this.src='https://via.placeholder.com/400x600?text=Error+Loading'">
            <div class="info">
                <div class="name">${userName}${userAge ? ', ' + userAge : ''}</div>
                <div class="desc">üìç ${userCity}<br>${userDesc}</div>
            </div>
        `;
    }

    container.appendChild(card);
}

        function nextCard() {
            if (current < users.length - 1) {
                current++;
                if (window.Telegram && tg.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('medium');
                }
                render();
            } else {
                alert("–ê–Ω–∫–µ—Ç—ã –≤ —Ç–≤–æ–µ–º –≥–æ—Ä–æ–¥–µ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!");
            }
        }

        function goToPay() {
            tg.HapticFeedback.impactOccurred('heavy');
            tg.openTelegramLink(`https://t.me/GetSparkBot?start=pay_vip`);
        }

        // –ó–∞–ø—É—Å–∫
        loadProfiles();
    </script>
</body>
</html>









